<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jellyfishmix.wxinterchange.dao.CollectionFileDao">
    <resultMap id="CollectionFileMap" type="com.jellyfishmix.wxinterchange.entity.CollectionFile">
        <result property="collectionId" column="collection_id" jdbcType="VARCHAR"/>
        <result property="fileId" column="file_id" jdbcType="VARCHAR"/>
        <result property="creationTime" column="creation_time" jdbcType="TIMESTAMP"/>
        <!--无特殊情况不开放modifiedTime-->
        <!--<result property="modifiedTime" column="modified_time" jdbcType="TIMESTAMP"/>-->
    </resultMap>

    <resultMap id="CollectionFileDTOMap" type="com.jellyfishmix.wxinterchange.dto.CollectionFileDTO">
        <result property="collectionId" column="collection_id" jdbcType="VARCHAR"/>
        <result property="fileId" column="file_id" jdbcType="VARCHAR"/>
        <result property="creationTime" column="creation_time" jdbcType="TIMESTAMP"/>
        <result property="fileName" column="file_name" jdbcType="VARCHAR"/>
        <result property="fileUrl" column="file_url" jdbcType="VARCHAR"/>
        <result property="fileSize" column="file_size" jdbcType="INTEGER"/>
        <result property="mimeType" column="mime_type" jdbcType="VARCHAR"/>
        <!--无特殊情况不开放modifiedTime-->
        <!--<result property="modifiedTime" column="modified_time" jdbcType="TIMESTAMP"/>-->
    </resultMap>

    <select id="queryByCollectionIdAndFileId" resultMap="CollectionFileMap">
        select collection_id, file_id
        from wx_interchange.collection_file
        where collection_id = #{collectionId} and file_id = #{fileId}
    </select>

    <!--查询收藏集文件列表-->
    <select id="queryListByCollectionId" resultMap="CollectionFileDTOMap">
        select
          collection_id, collection_file.file_id, file_info.file_name, file_info.file_url, file_info.file_size, file_info.mime_type, collection_file.creation_time
        from wx_interchange.collection_file
        join wx_interchange.file_info
            on collection_file.file_id = file_info.file_id
        where collection_id = #{collectionId}
        order by creation_time desc
        limit #{offset}, #{limit}
    </select>

    <!--新增数据（单个）-->
    <insert id="insert" keyProperty="id" useGeneratedKeys="true">
        insert into wx_interchange.collection_file(collection_id, file_id)
        values (#{collectionId}, #{fileId})
    </insert>

    <!--新增数据（多个）-->
    <insert id="insert" keyProperty="id" useGeneratedKeys="true">
        insert into wx_interchange.collection_file(collection_id, file_id)
        values
        <foreach collection="list" item="collectionFile" index="index" separator=",">
            (#{collectionFile.collectionId}, #{collectionFile.fileId})
        </foreach>
    </insert>

    <!--通过collection_id和file_id删除-->
    <delete id="deleteByCollectionIdAndFileId">
        delete from wx_interchange.collection_file where collection_id = #{collectionId} and file_id = #{fileId}
    </delete>

    <!--删除数据（多个）-->
    <delete id="deleteList">
        delete from wx_interchange.collection_file
        where (collection_id, file_id) in
        <foreach collection="list" item="collectionFile" index="index" open="(" separator="," close=")">
            (#{collectionFile.collectionId}, #{collectionFile.fileId})
        </foreach>
    </delete>
</mapper>